//------------------------------------------------------------------------------
// SoundManager
//------------------------------------------------------------------------------
// 役割:
// ゲーム内で使用するサウンド（BGM/SE）を SoundID で一元管理し、
// 読み込み・再生・停止・マスターボリューム制御を提供する。
//
// 設計意図:
// - GameObject ライフサイクル（Init/Uninit/Update/Draw）に統合して管理する。
// - SoundID -> Audio 配列の対応で高速にアクセスする（テーブル方式）。
// - どこからでもアクセスできるように、グローバル参照（簡易シングルトン）を提供する。
//
// 構成:
// - Audio m_Sounds[SoundID::Count] : SoundIDごとの音声実体
// - MasterVolume                  : 全体音量（0.0〜1.0にクランプ）
// - GetInstance()                 : グローバル参照取得（Init後のみ有効）
//
// NOTE:
// - GetInstance() は Init() 実行後にのみ使用可能（それ以前は未定義）。
// - 不正な SoundID は無視して return する（現状はエラー通知なし）。
// - Draw() は音声に描画がないため空実装。
// TODO:
// - BGM/SEのグループ制御（StopBGM / StopSE）
// - フェードイン/フェードアウト、クロスフェード
//------------------------------------------------------------------------------
#pragma once

#include "GameObject.h"
#include "Audio.h"
#include "SoundID.h"

/// サウンド管理クラス
/// - SoundID をキーに Audio を管理する
/// - マスターボリュームを掛け合わせた最終音量で再生する
/// - GetInstance() は Init() 後のみ有効
class SoundManager : public GameObject
{
public:
    // --------------------------------------------------------------------------
    // グローバル参照
    // --------------------------------------------------------------------------
    /// グローバルインスタンスの取得
    /// - 前提：Init() 済み（s_Instance != nullptr）
    /// - 失敗時：未定義動作（現状はチェックしない）
    static SoundManager& GetInstance() { return *s_Instance; }

    // --------------------------------------------------------------------------
    // ライフサイクル
    // --------------------------------------------------------------------------
    /// 初期化
    /// - グローバル参照を this に設定する
    void Init() override;

    /// 終了
    /// - 自分がグローバル参照なら nullptr に戻す
    /// - 保持している Audio を Uninit する
    void Uninit() override;

    /// 更新（現状は未使用）
    void Update(float deltaTime) override;

    /// 描画（音声は描画しないため空）
    void Draw() override;

    // --------------------------------------------------------------------------
    // サウンド操作
    // --------------------------------------------------------------------------
    /// サウンドの読み込み
    /// - id が範囲外の場合は何もしない（return）
    /// - filename は Audio::Load の契約に従う（nullptr可否などは Audio 側仕様依存）
    void Load(SoundID id, const char* filename);

    /// 再生
    /// - volume は個別音量（0.0〜1.0想定）。最終音量 = volume * m_MasterVolume
    /// - id が範囲外の場合は何もしない（return）
    void Play(SoundID id, bool loop = false, float volume = 1.0f);

    /// 停止
    /// - id が範囲外の場合は何もしない（return）
    void Stop(SoundID id);

    /// 全停止
    void StopAll();

    // --------------------------------------------------------------------------
    // 音量
    // --------------------------------------------------------------------------
    /// マスターボリュームの設定
    /// - 0.0〜1.0にクランプする
    void SetMasterVolume(float volume);

    /// マスターボリューム取得
    float GetMasterVolume() const { return m_MasterVolume; }

private:
    // --------------------------------------------------------------------------
    // 内部データ
    // --------------------------------------------------------------------------
    Audio m_Sounds[(int)SoundID::Count]{};  // 所有：SoundIDごとのAudio
    float m_MasterVolume = 1.0f;           // 0.0〜1.0（Setでクランプ）

    static SoundManager* s_Instance;       // 非所有：グローバル参照
};
